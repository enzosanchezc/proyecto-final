\section{Diseño}
\marginpar{(Pendiente)}

\subsection{Transformador}

La potencia aparente del transformador es la suma de la potencia de entrada y la potencia de salida:

$$ P_{t}=P_{i}+P_{o}=\frac{P_{o}}{\eta}+P_{o}=(1+\frac{1}{\eta})P_{o} $$

La tensión en el bobinado primario está dada por: 

$$ V_{1}=K_{t} f N_{1} \phi_{m} $$

donde $f$ es la frecuencia de conmutación de la señal de entrada y 
$K_t$ es un factor que vale 4.44 si la forma de onda es sinusoidal o 4 si es rectangular.

El flujo se relaciona con el área de la sección transversal de la trayectoria del flujo $A_{c}$ y la densidad de flujo $B$ de la siguiente manera:

$$ \Phi=BA $$

La densidad de corriente es:

$$ J=K_{j} A_{p}^{x} $$

donde $K_{j}$ y $x$ son constantes que dependen del núcleo magnético dadas por la siguiente tabla:

INSERTAR TABLA!

El factor $A_{p}$ se puede calcular como: 

$$ A_{p}=\left(\frac{P_{t} \cdot 10^{4}}{K_{t} f B_{m} K_{u} K_{j}}\right)^{\frac{1}{1+x}} {cm}^{4} $$

donde $K_u$ es el factor de relleno que varía entre 0.4 y 0.6 y $B_m$ es la densidad de flujo máxima.

La cantidad de alambre de cobre y la cantidad de material del núcleo (por lo general ferrita de hierro) determinan la capacidad de potencia del transformador. 
Existen distintos tipos de núcleo como toroidal, pot, power, E-laminated, EI, C, single-coil, tape-wound, etc. 
En este proyecto se trabajará con los núcleos disponibles provistos por la cátedra: EC70, E30 y E25. 

Especificaciones obtenidas por simulación:
\begin{itemize}
    \item Frecuencia de la forma de onda rectangular: $f=125kHz$
    \item Tensión máxima aplicada a la bobina del primario: $V_{1_{max}}=350V$
    \item Tensión de salida en el secundario: $V_{0}=12.6V$
    \item Corriente de salida en el secundario: $I_{0}=1.6A$
    \item Eficiencia: $n=95\%$
\end{itemize}

INSERTAR IMÁGEN DE SIMULACIÓN V1MAX!

\paragraph{Cálculos}

Potencia de salida:

$$ P_{o}=V_{o}\cdot I_{o}=12.6V\cdot 1.6A=20.16W $$

Potencia aparente: 

$$P_t=P_o+P_i=P_o\cdot\left(1+\frac{1}{n}\right)=20.16W\cdot\left(1+\frac{1}{0.95}\right)=41.38W  $$

INSERTAR IMÁGEN B-H DE KIKE!

En base a las curvas de magnetización se observa como las ferrites no soportan tanto flujo como el hierro y como disminuye la permeabilidad para campos mayores.  
Presenta el ciclo de histéresis y comienza a saturar en B=300mT. 
La saturación implica mayor circulación de corriente que conlleva a que el núcleo deje de responder. 
La saturación se da en campos menores si la temperatura aumenta con el funcionamiento del dispositivo. 
Por lo tanto se elige una inducción magnética máxima de $B_{m}=100mT$ para estar lejos del codo y asegurarnos tener la permeabilidad especificada en las hojas de datos. 

Para el núcleo E70, el área efectiva es: 

$$ A_{e}=279{mm}^{2} $$

Número de vueltas del primario:

$$ N_{1}=\frac{V_{1_{max}}}{K_{t}\cdot f\cdot B_{m}\cdot A_{a}}=\frac{350V}{4\cdot 125kHz\cdot 100mT\cdot 0.000279}=25.09\simeq 25 $$

Número de vueltas del secundario: 

$$ N_{2}=N_{1}\cdot\frac{V_{2}}{V_{1}} $$

Como no se requiere ni desea elevar o reducir la tensión del secundario, se elige una relación de vueltas 1:1. 
Por lo tanto, el número de vueltas del bobinado secundario es igual al del primario. 

$$ N_{2}=25 $$

$$ A_{p}=\left(\frac{41.38\cdot 10^{4}}{4\cdot 125kHz\cdot 100mT\cdot 0.4\cdot 366}\right)^{\frac{1}{1-0.14}} {cm}^4 $$

$$ J=366\cdot X^{-0.14} A/{cm}^2 $$

$$ J=584 A/{cm}^2 $$

\paragraph{Saturación magnética}

Cualquier componente de continua puede causar la saturación magnética del núcleo, 
elevando la corriente magnetizante. 
Para minimizar los efectos de la saturación, se puede utilizar un núcleo más grande o incluir un entrehierro.
El entrehierro permite que exista en el núcleo, además de una zona con alta permeabilidad propia del material magnético, 
otra zona de baja permeabilidad propia del espacio de aire. 
De esta forma en condiciones normales el flujo circula por el material magnético y en caso de saturación circula por el entrehierro 

\subsection{Inductor}

Se utiliza para almacenar energía y permitir su transferencia. 
Por el inductor circula una corriente continua. Si la misma es muy elevada puede saturar el núcleo magnético. 

Requisitos de diseño: 

\begin{itemize}
    \item Inductancia: $L=400\mu H$
    \item Corriente continua: $I_{dc}=1A$
\end{itemize}

Procedimiento para el diseño de un inductor con entrehierro:

\paragraph{Calculo la energía que debe almacenar el inductor}
$$ E=0.5\cdot L\cdot I_{dc}^2=200\mu HA^2 $$
\paragraph{Elección el tamaño del núcleo}
En base a la disponibilidad, se elige un E30 con material N27. 
Sus parámetros son:
\begin{itemize}
    \item Longitud efectiva: $l_e=67mm$
    \item Área efectiva: $A_e=60{mm}^2$
    \item $A_l=1800nH$ y $u_e=1600$ ($gap=0mm$)
    \item $A_l=630nH$ y $u_e=562$ ($gap=0.1mm$)
    \item $A_l=400nH$ y $u_e=353$ ($gap=0.18mm$)
    \item $A_l=200nH$ y $u_e=179$ ($gap=0.34mm$)
\end{itemize}

\paragraph{Verificar energía almacenada}

Se debe corroborar que la energía que puede almacenar el inductor sin entrehierro sea suficiente

Con $B_m=100mT$:
$$ E_{singap}=\frac{0.5\cdot B_m^2\cdot {volumen}}{u_0\cdot u_e}=\frac{0.5\cdot B_m^2\cdot A_e\cdot l_e}{u_0\cdot u_e}=10\mu HA^2 $$

Con $B_m=200mT$:
$$ E_{singap}=\frac{0.5\cdot B_m^2\cdot {volumen}}{u_0\cdot u_e}=\frac{0.5\cdot B_m^2\cdot A_e\cdot l_e}{u_0\cdot u_e}=40\mu HA^2 $$

En ambos casos es menor a la energía que debe almacenar el inductor por lo que se evidencia la necesidad de incluir un entrehierro. 

\paragraph{Dimensionar el entrehierro}

El entrehierro $l_0$ debe almacenar la energía $E$ con $B_{max}=100mT$.
En caso de ser necesario puede llevarse a $B_{max}=200mT$ sin problema. 

Con $B_m=100mT$:
$$ l_0=\frac{2\cdot E\cdot u_0}{A_e\cdot B_m^2}=0.84mm $$

Con $B_m=200mT$:
$$ l_0=\frac{2\cdot E\cdot u_0}{A_e\cdot B_m^2}=0.2mm $$

Gap necesario con un núcleo tipo E:

Con $B_m=100mT$:
$$ g=\frac{l_0}{2}=0.42mm $$

Con $B_m=200mT$:
$$ g=\frac{l_0}{2}=0.1mm $$

\paragraph{Dimensionar el número de vueltas}

Elección de N para conseguir la inductancia L requerida.

Con $B_m=100mT$:
$$ N=\sqrt{\frac{L\cdot l_0}{A_e\cdot u_0}}=67\ vueltas$$

Con $B_m=200mT$:
$$ N=\sqrt{\frac{L\cdot l_0}{A_e\cdot u_0}}=34\ vueltas $$

\paragraph{Construcción}

Bobinar el inductor y medir L. Si no verifica el valor deseado corregir
considerando $L = A_LN^2$ (el valor de $A_L$ que corresponde a $l_0$ se obtiene con
el número de vueltas del primer intento).

Mediante la constante de tiempo en un circuito RL con una forma de onda cuadrada a la entrada se estima la inductancia en $L=450\mu H$. 

\paragraph{Validación}

Verificar que el valor de L se mantiene con la corriente de DC de trabajo.
Esto generalmente se realiza sobre el propio convertidor midiendo la
tensión aplicada sobre el inductor y la pendiente de la corriente.

DRIVER

1) Tensión de control de puerta: Vdrv

Es la amplitud de la forma de onda PWM:  

Vdrv=8V

2) Frecuencia de control de puerta: fdrv

Es la frecuencia de conmutación: 

fdrv=125kHz;

3) Carga total del terminal Gate: Qc

Una de las principales pérdidas de potencia en los transistores MOSFET son las pérdidas por control de puerta o Gate. 
El encendido y apagado del MOSFET implica la carga y descarga del capacitor interno, 
el cual recibirá o entregará carga cuando la tensión en el mismo se modifique. 
Se requiere de una cierta carga para cambiar la tensión del terminal Gate entre 0 y Vdrv. 
Su valor se obtiene mediante el gráfico de la hoja de datos del IRF840 con los siguientes datos:
Rango: 0-63nC
Vgs=6V
Vds=100V
De forma estimada: 
Qg=26nC

INSERTAR IMÁGEN DE HOJA DE DATOS IRF840: FIGURA 6 Vgs vs Qg

Con este parámetro pueden determinarse la corriente promedio de polarización requerida para controlar el terminal Gate 
y las pérdidas de potencia de carga de puerta

Ig=Qg*fdrv=3.25mA

Pgate=Vdrv*Qg*fdrv=26mW

4) Delta VC1 y Delta VC2: INSERTAR SÍMBOLOS COMO ANTES

La suma de los ripples en ambos capacitores de acoplamiento aparece en el terminal Gate. 
Se elige el siguiente criterio:
DeltaVc=0,1*Vdrv
deltavc1=deltavc2=deltavc/2;

5) Tensión del diodo de rueda libre del secundario: Vdc2

Se utiliza el mismo diodo que en el convertidor forward, modelo UF4007. 
La tensión directa máxima se obtiene de la hoja de datos: 
Vdc2=1.7V;

6) Ciclo de trabajo máximo 

Definido por el conversor forward.

Dmáx=0.5

7) Resistencia entre Gate y Source: Rgs

Su valor se despeja en base a la constante de tiempo deseada en el transitorio de la tensión en el capacitor de acoplamiento.

Tao=50us

INSERTAR CÁLCULO DE RGS

$Rgs=10k\Omega$

8) Inductancia magnetizante: Lm

Medida con el instrumento. 

Lm=186uH;

9) Cdrv: Capacitor de bypass

Provee de la corriente necesaria al encenderse. 

FALTA CÁLCULO

INSERTAR FÓRMULA DE LA ECUACIÓN 18 JUNTO A LA DESCRIPCIÓN DE SUS parámetros

10) Capacitor de acoplamiento Cc1

$$ C_{C_1}(D)=\frac{Q_g}{\Delta V_{C_1}}+\frac{(V_{drv}-V_{{dc}_2})\times D}{\Delta V_{C_1}\times R_{gs}\times f_{drv}}+\frac{V_{drv}\times (D^2-D^3)}{\Delta V_{C1}\times 4\times L_m\times f_{drv}^2} $$

La capacidad mínima que asegura permanecer por debajo del ripple de tensión máximo en todas las condiciones de operación 
se puede encontrar determinando el máximo de la expresión anterior:

Cc1=328.3nF

11) Capacitor de acoplamiento Cc2

Cc2=(Qg/deltavc2)+(((Vdrv-Vdc2)*Dmax)/(deltavc2*Rgs*fdrv))

Cc2=71.3nF

12) Resistencia serie del primario de amortiguamiento

$Rcmin=2*sqrt(Lm/Cc1)=47.6\Omega$

Se elige:

Rc=X